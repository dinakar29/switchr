% \VignettePackage{switchr}
% \VignetteIndexEntry{switchr basics}
% \VignetteEngine{knitr::rmarkdown}

# The switchr package

## Managing and populating package libraries


Different versions of R packages are appropriate for different applications,
including package development, solo analysis, and
collaboration. *switchr* provides a framework for creating, populating,
managing, and switching between multiple package libraries from within
an R session.

```{r echo=FALSE, results="hide"}
library(switchr)
switchrBaseDir(file.path(tempdir(), ".switchr"))
switchrDontUnload(c("knitr", "evaluate", "digest", "formatR", "highr", 
                    "markdown", "stringr"))
options(width=40)

```


We create and use switchr package libraries by referring to them by
name using the /switchTo()/ function as seen below.

```{r}
switchTo("vign1")
```

The first time this code is run a "vign1" library is created and activated. By
activate we mean that it replaces the current User- and (by default) Site- 
library locations which R uses to find packages during the loading process.

To stop using "vign1" we simply call /switchBack()/:

```{r}
switchBack()
```

## Representing package cohorts

Empty package libraries are, of course, of limited use. The other main 
functionality *switchr* offers is installation of packages from a wide
variety of sources (git, svn, package repositories, and the CRAN Archive
among them), both individually and as cohorts.

We do this via a generalized form of a package repository called a 
/package manifest/, which includes a listing of packages and the information
switchr needs to install them (primarily location of their source code).

We can create a package manifest from scratch via the PkgManifest, though there
convenience functions for common use-cases such as Github packages

```{r}
man = PkgManifest(name = "fastdigest", url = "https://github.com/gmbecker/fastdigest")
man
```

The GithubManifest function allows us to easily construct a manifest listing 
many R packages hosted in various repositories across github.
```{r}

man2 = GithubManifest("gmbecker/fastdigest",
		      "gmbecker/gRAN",
		      "rstudio/shiny",
		      "ropensci/gistr")
man2
```


## Seeding package libraries

When creating a new package library, we can /seed/ it via a package manifest.
When we do this, the packages listed in the manifest are automatically installed
during package creation.

NOT RUN:
```{r eval=FALSE}
switchTo("vign2", man)
```

After the package library is created in this way, it acts as normal.

## Installing packages from manifests

*switchr* provides the install_packages function, which allows users to install
from package manifests as if they were package repositories. This includes 
supporting complex webs of dependencies, even between non-repository-hosted
packages, e.g. those on GitHub.

NOT RUN:
```{r eval=FALSE}
man3 = GithubManifest("gmbecker/fastdigest", "gmbecker/RCacheSuite",
    "duncantl/CodeDepends")
install_packages("RCacheSuite", man3)
```

NOT RUN:
```{r eval=FALSE}
switchBack()
```

## Exact package versions

install_packages supports installing exact package versions from a number 
of sources, including CRAN, GitHub, and Bioconductor

We do this by passing a data.frame with version information to the function

NOT RUN:
```{r eval=FALSE}
install_packages("devtools", versions = data.frame(name="devtools", version="1.5",
			     	      		   stringsAsFactors=FALSE))
```

A major function of switchr is reproducibility package libraries

whether it be to ensure comparability between collaborators or
reproducing an old result. 
